# 知识蒸馏工具项目 - SQLite集成方案

## 项目背景
知识蒸馏工具是一个本地化源信息治理工具，提供：
- 文件级去重
- 内容块分析  
- 语义相似度识别

当前使用JSON文件存储存在查询效率低、数据管理困难的问题。

## SQLite集成价值
采用SQLite将带来以下优势：
- 高效的数据查询和过滤能力
- 更强的数据一致性和完整性
- 简化复杂数据关系管理
- 为功能扩展提供基础支持

## 核心开发任务

### 1. 数据库设计
#### 1.1 数据库架构
- [ ] 设计核心表结构：
  - files (文件信息)
  - blocks (内容块)
  - analysis_results (分析结果)  
  - user_decisions (用户决策)
- [ ] 设计表间关系和外键约束
- [ ] 优化索引策略提升查询性能
- [ ] 实现数据库版本管理

#### 1.2 数据访问策略
- [ ] 选择ORM方案(SQLAlchemy)
- [ ] 实现连接池管理
- [ ] 设计事务处理机制
- [ ] 实现查询缓存优化

### 2. 存储层实现
#### 2.1 SQLiteStorage类
- [ ] 实现StorageInterface接口
- [ ] 完成数据库连接初始化
- [ ] 实现版本升级机制

#### 2.2 基础功能
- [ ] 实现文件CRUD操作
- [ ] 实现内容块存储检索  
- [ ] 实现分析结果存储
- [ ] 实现用户决策管理

#### 2.3 高级功能
- [ ] 支持复杂条件查询
- [ ] 实现多表关联查询
- [ ] 添加分页排序支持

### 3. 模块集成
#### 3.1 CzkawkaAdapter改造
- [ ] 集成存储接口
- [ ] 实现重复文件数据库存储
- [ ] 优化扫描结果缓存

#### 3.2 增量处理
- [ ] 实现文件变更检测
- [ ] 支持增量扫描
- [ ] 优化数据合并逻辑

### 4. 引擎优化
#### 4.1 初始化改造
- [ ] 支持存储接口注入
- [ ] 实现数据库配置管理
- [ ] 添加连接状态监控

#### 4.2 流程优化
- [ ] 集成文件预过滤
- [ ] 优化批量数据库操作
- [ ] 实现分析结果增量更新

### 5. 测试保障
#### 5.1 单元测试
- [ ] 覆盖存储层核心功能
- [ ] 测试数据库操作
- [ ] 验证版本升级

#### 5.2 集成测试
- [ ] 测试模块间集成
- [ ] 验证完整工作流
- [ ] 性能基准测试

### 6. 文档
- [ ] 编写数据库设计文档
- [ ] 更新架构说明
- [ ] 编写维护指南

## 实施计划
1. 第一阶段：实现存储层核心功能
2. 第二阶段：完成模块集成
3. 第三阶段：性能优化和高级功能

## 风险控制
- 性能优化：通过索引设计和查询优化
- 复杂度管理：良好的接口抽象和模块化设计
- 依赖管理：仅使用标准库SQLite